#! /bin/sh

#-- switch-theme --#
# A script to switch the GTK, Qt, dunst, and BetterDiscord themes.
# $1 - wallpaper filename (`mountain` resolves to ~/Pictures/Wallpapers/mountain.jpg)
# Dependencies:
#	- wal
#	- feh
#	- wallmaker (my wallpaper maker script)
#	- sassc
#	- themix-theme-oomox-git
#	- bspwm
#	- dunst-start (my dunst script)
# ~ ADIGEN

#########
## wal ##
#########
# If the wallpaper filename contains 'gradient',
# means it was generated by `wallgrad`. Set the background color
# (This is done as usually those wallpapers generate a ridiculously bright background color)
if [[ $1 =~ "gradient" ]]; then
	wal -i $HOME/Pictures/Wallpapers/${1}.* -b '#101622'
else
	wal -i $HOME/Pictures/Wallpapers/${1}.*
fi

source ~/.cache/wal/colors.sh

#########
## feh ##
#########
#feh --bg-fill --conversion-timeout 100 $HOME/Pictures/Wallpapers/${1}.*
$(wallmaker `cat ~/.cache/wal/wal` $HOME/Pictures/Wallpapers/generated.png 50 50 `emos` && feh --bg-fill $HOME/Pictures/Wallpapers/generated.png) &

#############
## Discord ##
#############
mkdir -p ~/.config/BetterDiscord/themes
{ echo -n '//META{"name":"wal","description":"Script generated theme mashing ClearVision with pywal colors.","author":"ADIGEN","version":"1.0"}*//'; sassc -t compact -I $HOME/.config/wal-discord -s < $HOME/.config/wal-discord/master.scss; } > $HOME/.config/BetterDiscord/themes/wal.theme.css &&

###########
## Dunst ##
###########
DUNST_FILE=~/.config/dunst/dunstrc

# Update dunst based on pywal colors.
sed -i '/background = /s/.*/    background = "'$color0'"/' $DUNST_FILE
sed -i '/foreground = /s/.*/    foreground = "'$color7'"/' $DUNST_FILE
sed -i '/frame_color = /s/.*/    frame_color = "'$color5'"/' $DUNST_FILE

killall -q dunst; dunst-start & disown

##############
## GTK & Qt ##
##############
oomox-cli -o wal -t $HOME/.local/share/themes $HOME/.cache/wal/colors-oomox &&

###############
## Alacritty ##
###############
fixtheme ~/.config/alacritty/alacritty.yml &&

###########
## BSPWM ##
###########
bspc config normal_border_color "$color0"
bspc config active_border_color "$color0"
bspc config focused_border_color "$color5"
bspc config presel_feedback_color "$color1"

#############
## OpenRGB ##
#############
lights
